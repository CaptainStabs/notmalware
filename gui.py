from PyQt5 import QtWidgets, QtCore, uic
import sys
import os
from datetime import datetime as dt

os.environ["QT_AUTO_SCREEN_SCALE_FACTOR"] = "1"




class Ui(QtWidgets.QDialog):
    """
    Initializes the Ui class, which is a subclass of QtWidgets.QDialog.
    This function sets up the user interface by loading the 'not_malware.ui' file and
    connecting the 'thanks_button' click event to the 'show_message' method.

    Parameters:
    None

    Returns:
    None

    Raises:
    None
    """
    def __init__(self, unsafe_mode):
        super(Ui, self).__init__()
        uic.loadUi('not_malware.ui', self)
        self.setWindowTitle("Totally Not Malware")
        self.setWindowFlag(QtCore.Qt.WindowContextHelpButtonHint, False)
        self.thanks_button.clicked.connect(self.show_message)
        self.tries = 0
        if unsafe_mode:
                self.setWindowFlag(QtCore.Qt.WindowCloseButtonHint, False)
        self.show()

    def show_message(self):
        """
        This function displays a message box based on the input values of cardnumber, expiration, and security_code.

        Parameters:
        - cardnumber (str): The credit card number entered by the user.
        - expiration (str): The expiration date of the credit card entered by the user.
        - security_code (str): The security code of the credit card entered by the user.

        Returns:
        - None: This function does not return any value. It only displays a message box.

        Raises:
        - None: This function does not raise any exceptions.
        """
        cardnumber = self.card_number.text()
        expiration = self.expiry_date.text()
        security_code = self.security_code.text()
        
        if cardnumber and expiration and security_code:
            if cardnumber and any(char.isalpha() for char in cardnumber):
                if self.tries < 4:
                    QtWidgets.QMessageBox.critical(self, "Error", "Oops! Looks like you have letters in your card number.")
                else:
                    QtWidgets.QMessageBox.critical(self, "Error", "Oops! Hey I know the world is tough but it isnt tough enough to justify you USING FUCKING LETTERS IN A CARD NUMBER")
                self.tries += 1
                return
            if cardnumber.isdigit() and len(cardnumber) not in (16, 17):
                if self.tries <4:
                    if len(cardnumber) > 16:
                        QtWidgets.QMessageBox.critical(self, "Error", f"Oops! you appear to have too many numbers, you have {len(cardnumber)} Numbers, The Max is 16")
                    elif len(cardnumber) < 16:
                        QtWidgets.QMessageBox.critical(self, "Error", f"Oops! you appear to be missing some numbers, you have {len(cardnumber)} Number(s), You must have 16")
                else:
                    if len(cardnumber) > 16:
                        QtWidgets.QMessageBox.critical(self, "Error", f"Oops! you appear to have too many numbers, you have {len(cardnumber)} Numbers, The Max is 16 YOU FUCKING MORON, NICE TIME COUNT INSTEAD OF SPAMMING NUMBERS")
                    else:
                        QtWidgets.QMessageBox.critical(self, "Error", f"Oops! you appear to be missing some numbers, you have {len(cardnumber)} Number(s), You must have 16 HOW MANY FUCKING TIMES DO I HAVE TO SAY  THIS")  
                self.tries += 1
                return
                        
            
            
            if len(security_code) not in (3, 4):
                if self.tries < 2:
                    if len(security_code) > 4:
                        QtWidgets.QMessageBox.critical(self, "Error", "Oops! Looks like you put too many digits in your secruity code")
                    elif len(security_code) < 3:
                        QtWidgets.QMessageBox.critical(self, "Error", "Oops! Looks like you put too few digits in your security code")
                    self.tries += 1
                else:
                    QtWidgets.QMessageBox.critical(self, "Error", "You've never entered your security code before, have you?")
            
            # This is in the else block here because the if block is false if the security code is valid
            else:
                if "/" not in expiration:
                    if len(expiration) == 4:
                        expiration = f"{expiration[:2]}/{expiration[2:]}"
                    elif len(expiration) == 3:
                        expiration = f"{expiration[0]}/{expiration[1:]}"

                try:
                    date = dt.strptime(expiration, "%m/%y")
                    QtWidgets.QMessageBox.information(self, "Transaction Complete", "$12,420.69 was transferred from your account.")
                except ValueError:
                    if self.tries < 2:
                        QtWidgets.QMessageBox.critical(self, "Error", "The date you entered is invalid.")
                        self.tries += 1
                    else:
                        QtWidgets.QMessageBox.critical(self, "Error", "You don't understand how dates work, do you?")

        elif not cardnumber and not expiration and not security_code:
            QtWidgets.QMessageBox.critical(self, "Error", "You can't leave everything blank :(")
            return

        elif not cardnumber:
            if self.tries < 4:
                QtWidgets.QMessageBox.critical(self, "Error", "Oops! Looks like you forgot the credit card number")
            else:
                QtWidgets.QMessageBox.critical(self, "Error", "You forgot your card number dumbass.")
            self.tries += 1
        elif not expiration:

            if self.tries < 4:
                QtWidgets.QMessageBox.critical(self, "Error", "Oops! Looks like you forgot the expiration date")
            else:
                QtWidgets.QMessageBox.critical(self, "Error", "You forgot the expiration date dumbass.")
            self.tries += 1
        elif not security_code:
            if self.tries < 4:
                QtWidgets.QMessageBox.critical(self, "Error", "Oops! I can't take your money without a security code")
            else:
                QtWidgets.QMessageBox.critical(self, "Error", "Oops! Looks like you forgot the fucking security code you moron")
            self.tries += 1

            

        

app = QtWidgets.QApplication(sys.argv)
unsafe_mode = "--unsafe" in sys.argv
window = Ui(unsafe_mode)
app.exec_()
