from PyQt5 import QtWidgets, QtCore, uic
import sys
import os
import dateutil.parser

os.environ["QT_AUTO_SCREEN_SCALE_FACTOR"] = "1"




class Ui(QtWidgets.QDialog):
    def __init__(self):
        super(Ui, self).__init__()
        uic.loadUi('not_malware.ui', self)
        self.setWindowTitle("Totally Not Malware")
        self.setWindowFlag(QtCore.Qt.WindowContextHelpButtonHint, False)
        self.thanks_button.clicked.connect(self.show_message)
        self.tries = 0

        self.show()

    def show_message(self):
        cardnumber = self.card_number.text().replace(" ", "")
        expiration = self.expiry_date.text()
        security_code = self.security_code.text()
        if len(cardnumber) != 16:
            if len(cardnumber) == 0:
                if self.tries < 4:
                    QtWidgets.QMessageBox.critical(self, "Error", "Oops! Looks like you forgot the credit card number")
                else:
                    QtWidgets.QMessageBox.critical(self, "Error", "You forgot your card number dumbass.")
                self.tries += 1
                    
                    
        if len (cardnumber) > 0:    
            QtWidgets.QMessageBox.critical(self, "Error", f"Oops! Card number must be exactly 16 digits, but yours is {len(cardnumber)} digits long.")
            return  
        
        if cardnumber and expiration and security_code:
            if len(security_code) not in (3, 4):
                if self.tries < 2:
                    if len(security_code) > 4:
                        QtWidgets.QMessageBox.critical(self, "Error", "Oops! Looks like you put too many digits")
                    elif len(security_code) < 3:
                        QtWidgets.QMessageBox.critical(self, "Error", "Oops! Looks like you put too few digits")
                    self.tries += 1
                else:
                    QtWidgets.QMessageBox.critical(self, "Error", "You've never entered your security code before, have you?")
            else:
                try:
                    date = dateutil.parser.parse(expiration)
                    QtWidgets.QMessageBox.information(self, "Transaction Complete", "$12,420.69 was transferred from your account.")
                except:
                    if self.tries < 2:
                        QtWidgets.QMessageBox.critical(self, "Error", "The date you entered is invalid.")
                        self.tries += 1
                    else:
                        QtWidgets.QMessageBox.critical(self, "Error", "You don't understand how dates work, do you?")

        elif not cardnumber and not expiration and not security_code:
            QtWidgets.QMessageBox.critical(self, "Error", "You can't leave everything blank :(")  
            
        elif not expiration:

            if self.tries < 4:
                QtWidgets.QMessageBox.critical(self, "Error", "Oops! Looks like you forgot the expiration date")
            else:
                QtWidgets.QMessageBox.critical(self, "Error", "You forgot the expiration date dumbass.")
            self.tries += 1
            

        

app = QtWidgets.QApplication(sys.argv)
window = Ui()
app.exec_()
